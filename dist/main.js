"use strict";var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function r(a,s){try{var i=t[a](s),o=i.value}catch(e){return void n(e)}if(!i.done)return Promise.resolve(o).then(function(e){r("next",e)},function(e){r("throw",e)});e(o)}("next")})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(function(){var e,t,n,r,a,s,i,o,l,c,u,d,h;d=function(){var e;return(e=console).log.apply(e,["[DEBUG]"].concat(Array.prototype.slice.call(arguments)))},(c=function(){var e;return(e=document).getElementById.apply(e,arguments)})("chunks"),e=c("container"),t=c("spacer"),n=c("table"),r=c("top"),u=[!1],(l=function(){var e,t,n;return(e=document.createElement("canvas")).classList.add("chart"),e.width=265,e.height=265,r.appendChild(e),t=e.getContext("2d"),n=new Chart(t,{type:"line",data:{labels:[],datasets:[{label:"Graphics",backgroundColor:"red",borderColor:"red",data:[],fill:!1}]},options:{responsive:!1,title:{display:!0,text:"Graphics"},tooltips:{mode:"index",intersect:!1},hover:{mode:"nearest",intersect:!0},scales:{xAxes:[{display:!0,scaleLabel:{display:!0,labelString:"X"}}],yAxes:[{display:!0,scaleLabel:{display:!0,labelString:"Y"}}]}}}),u.push(n)})(),l(),l(),l(),l(),h=function(e){var t,n,r,a,s,i,o,l;for(n=[],a=0,s=e.length;a<s;a++)for(o in r=e[a])for(o in i=r[o],u)u[o],null==n[o]&&(n[o]=[]),n[o].push(parseFloat(i[o]));for(o in l=[],n)void 0!==(t=n[o])&&(!1!==u[o]?(u[o].data.datasets[0].data=t,u[o].data.labels=t,l.push(u[o].update())):l.push(void 0));return l},s=0,o=0,i=0,a=0,function(){var e,t,r;for(e=document.createElement("tbody"),r=0,t="";r<50;)t+="<tr class='row'><td>"+r+"</td></tr>",r++;e.innerHTML=t,n.appendChild(e),s=e.clientHeight,n.removeChild(e),d("chunk pixel size:",s)}(),(new(function(){var r=function(){function r(){_classCallCheck(this,r),this.ws=new WebSocket("{{.}}"),this.$activeChunks={},this.readyState=2,this.datas={},this.i=0,this.onscrollCalled=!1}return _createClass(r,[{key:"bind",value:function(){var t;return t=this,e.onscroll=function(){return t.onscroll.apply(t,arguments)},this.ws.onmessage=function(){return t.commands.message.apply(t,arguments)},this.ws.onopen=function(){return t.commands.open.apply(t,arguments)},this.ws.onerror=function(){return t.commands.error.apply(t,arguments)},this.ws.onclose=function(){return t.commands.close.apply(t,arguments)}}},{key:"onscroll",value:function(){var t,r,a,i,o,l,c,u,p,f,v;if(this.readyState<=0){for(c in t=(f=e.scrollTop)+e.clientHeight,p=this,v=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,a,i,o,l,c,u,h,f,v,y,m;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=p.$activeChunks[t]){e.next=18;break}return(r=p.$activeChunks[t]=document.createElement("tbody")).style.position="absolute",r.style.top=t*s+"px",i=(o=50*t)+50,p.i++,p.get(o,i,p.i),e.next=10,p.receive(p.i);case 10:for(l=e.sent,a=parseCSV(l,";"),c="",h=0,v=a.length;h<v;h++){for(m=a[h],c+="<tr class='row'>",f=0,y=m.length;f<y;f++)u=m[f],c+="<td>"+u+"</td>";c+="</tr>"}return r.innerHTML=c,r.chunkData=a,n.appendChild(r),e.abrupt("return",d("loaded new chunk",r));case 18:case"end":return e.stop()}},e,this)})),(l=function(e){return v.apply(this,arguments)})(Math.floor(f/s)),l(Math.floor(t/s)),o=[],u=this.$activeChunks){r=u[c];try{a=(i=parseInt(r.style.top))+s,i<=f&&a>=f||i<=t&&a>=t?o.push(r.chunkData):(delete this.$activeChunks[c],n.removeChild(r),d("deleted invisible chunk",r))}catch(e){}}return h(o)}}},{key:"calculateSize",value:function(e){return o=e,i=Math.ceil(o/50),a=s*i,t.style.height=a+"px"}},{key:"push",value:function(e,t){return this.datas[t].data=e,this.datas[t].received=!0}},{key:"receive",value:function(e){var t;return this.datas[e]={received:!1},t=this,new Promise(function(n){return Object.defineProperty(t.datas[e],"received",{set:function(){var r;return r=t.datas[e],delete t.datas[e],n(r.data)}})})}},{key:"get",value:function(e,t,n){return this.ws.send('{"type":"read","start":'+e+',"end":'+t+',"id":'+n+"}")}}]),r}();return r.prototype.commands={lines:function(e){return this.calculateSize(e)},message:function(e){var t;switch((t=JSON.parse(e.data)).type){case"linesCount":if(this.commands.lines.call(this,t.linesCount),d("lines message:",t.linesCount),this.readyState--,!this.onscrollCalled)return this.onscrollCalled=!0,this.onscroll();break;case"read":return d("data message"),this.push.call(this,t.lines,t.id);case"error":return alert("ERROR: "+t.error)}},open:function(){return d("connection open"),this.ws.send('{"type":"linesCount"}'),this.readyState--},error:function(e){return d("connection error:",e)},close:function(){return d("connection closed")}},r}.call(this))).bind()}).call(void 0);